<!DOCTYPE html>
<html lang="en-us">

<head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="baidu-site-verification" content="8AnPkcOkto" />
    <meta name="description" content="白山云、白山云科技、云链、云分发、云存储、云聚合、云后市场、数据生命周期管理" />
    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    

    <title>
        
        “双十一”高并发应对之道 - BaishanCloud
        
    </title>

    <!-- CSS -->
    <link rel="stylesheet" href="/zh/public/css/poole.css">
    <link rel="stylesheet" href="/zh/public/css/syntax.css">
    <link rel="stylesheet" href="/zh/public/css/hyde.css">
    <link rel="stylesheet" href="/zh/public/css/bootstrap.css">
    <link rel="stylesheet" href="/zh/public/css/lightbox.min.css">
    <link rel="stylesheet" href="/zh/public/css/main.css">

    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144"
          href="/zh/public/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/zh/public/favicon.ico">
</head>


<body>

<div class="sidebar hidden-xs">
    <div class="sidebar-sticky">
        <ul id="nav">
            <li><a class="sidebar-nav-item " href="/zh">首页</a></li>
            <li class="">
                <a id="mdNav" class="sidebar-nav-item nav-xs-first dropdown-toggle" data-target="#" data-toggle="dropdown">服务</a>
                <ul class="dropdown-menu my-dropdown" aria-labelledby="mdNav">
                    <li><a class="" href="/zh/2017/01/01/cdn-x/">CDN-X 云分发</a></li>
                    <li><a class="" href="/zh/2017/01/02/cwn-x/">CWN-X 云存储</a></li>
                    <li><a class="" href="/zh/2017/01/03/cln-x/">CLN-X 云聚合</a></li>
                </ul>
            </li>
            <li><a class="sidebar-nav-item" href="/zh/2017/01/04/technology/">技术</a></li>
            <li><a class="sidebar-nav-item" href="/zh/2016/06/01/BSC-Culture/">生活</a></li>
            <li><a class="sidebar-nav-item" href="/zh/2016/04/01/Customers/">客户</a></li>
            <li><a class="sidebar-nav-item" href="/zh/2017/01/05/brief/">白山简介</a></li>
            <li><a class="sidebar-nav-item" href="/zh/2017/01/06/management/">白山领导力</a></li>
            <li><a class="sidebar-nav-item" href="/zh/2017/01/20/news/">白山新闻</a></li>
            <li><a class="sidebar-nav-item" href="/zh/2016/07/01/Careers/">白山招聘</a></li>
            <li><a class="sidebar-nav-item" href="/zh/2016/08/01/Contact-Us/">联系白山</a></li>
        </ul>
    </div>
</div>

<button class="nav-xs collapsed visible-xs"  id="navXSButton">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
</button>
<div class="clearfix nav-xs-bg"></div>
<div class="nav-xs-box" id="navXSBox">
    <div class="nav-xs-close"></div>
    <div class="nav-xs-content visible-xs" id="navXSContent">
        <ul class="nav navbar-nav">
            <li><a class="nav-xs-first" href="/zh">首页</a></li>
            <li class="">
                <a id="xsNavButton" class="nav-xs-first">服务</a>
                <ul class="xs-products-ul" id="xsNav">
                    <li><a class="" href="/zh/2017/01/01/cdn-x/">CDN-X 云分发</a></li>
                    <li><a class="" href="/zh/2017/01/02/cwn-x/">CWN-X 云存储</a></li>
                    <li><a class="" href="/zh/2017/01/03/cln-x/">CLN-X 云聚合</a></li>
                </ul>
            </li>
            <li><a class="nav-xs-first" href="/zh/2017/01/04/technology/">技术</a></li>
            <li><a class="nav-xs-first" href="/zh/2016/06/01/BSC-Culture/">生活</a></li>
            <li><a class="nav-xs-first" href="/zh/2016/04/01/Customers/">客户</a></li>
            <li><a class="nav-xs-first" href="/zh/2017/01/05/brief/">白山简介</a></li>
            <li><a class="nav-xs-first" href="/zh/2017/01/06/management/">白山领导力</a></li>
            <li><a class="nav-xs-first" href="/zh/2017/01/20/news/">白山新闻</a></li>
            <li><a class="nav-xs-first" href="/zh/2016/07/01/Careers/">白山招聘</a></li>
            <li><a class="nav-xs-first" href="/zh/2016/08/01/Contact-Us/">联系白山</a></li>
        </ul>
    </div>
</div>



    <div class="container my-container">
        <div class="content-page-header hidden-xs">
    <img src="/zh/public/image/logo_black_cn.png" height="40px">
</div>
    <div class="post">
       
        <img class="logo visible-xs" src="/zh/public/image/logo_black.png" height="32px">
        <div class="post-content">
            <div class="col-sm-8">
                <div class="news-content">
                    <h2>“双十一”高并发应对之道</h2>

<hr>

<p>发布时间：2016-09-30</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>作者简介
丛磊 白山云科技合伙人兼工程副总裁
2016年加入白山，负责云链体系的设计与构建等工作；2006年至2015年，就职于新浪，带领团队从事云相关领域技术研发工作。国内最大公有云PaaS平台——SAE创始人；工信部可信云服务认证评委。
</code></pre></div>
<h3>1   “双十一”压力</h3>

<p>不知从何时起，“双十一”成为了“购物节”，这种全民狂欢式购物对金融行业是一个巨大挑战，短时间的高并发会给数据接口带来巨大压力。据悉，2015年天猫峰值交易量达到14万次/秒，而2009年仅为400次/秒。</p>

<p>用户每一笔交易背后都包含了多项操作：首先，用户浏览多个商品才触发一次购物行为；再次，实际交易前，需要确保库存、配送、商家优惠政策等信息；生成订单后，执行支付接口，要求高度一致性和可靠性；支付完成后需要回调多个逻辑，包括积分计算、折扣返点、物流配送等。</p>

<p>可见14万/秒的交易峰值，不仅对于金融机构，即便是具备丰富应对高并发经验的互联网公司，都不是一件容易的事。更为紧迫的是，随着IOT设备进一步普及，“双十一”带来的压力将越来越大，据某电商平台预测，2016年“双十一”峰值压力将再翻5倍。在可预见的未来，交易完全有可能达到100万次/秒！</p>

<h3>2    应对之道</h3>

<p>本人曾参与研发交易量10万/秒级别的系统，这里对如何应对超高并发提出一些建议。其实，无论是“秒杀”还是“双十一”，都没有灵丹妙药，一个真正能抗超高并发的金融系统，必然由系统中每个组件优化而成。让每个组件发挥最大威力，并对系统充分解耦，才能做出可靠的平台。</p>

<p>应对超高并发，最重要两个技术：“缓存-Cache&quot;和&quot;异步化-队列”。</p>

<h3>3   缓存－ Cache</h3>

<p>这里的Cache不是传统意义上的Redis/Memcache等系统Cache组件，而是从用户端到最后数据层所有环节的Cache。</p>

<p>对于高并发场景，第一条准则就是为用户行为所有环节加上合理的Cache。</p>

<p>业务层次图如下：
<img src="http://static.zybuluo.com/bsc-jane/rwlqlh3fsjg3u1zh9ffak9db/1.jpg" alt="1.jpg-62.8kB"></p>

<p>如图所示，用户访问/交易行为的起点是浏览器。首先对浏览器端进行合理的Cache设置，即对其中页面设置合理的过期规则，配合CDN端，让部分元素响应直接在浏览器Cache端返回，有效降低业务访问压力；其次，虚线内展示的是业务端，主要由两部分构成，一个是计算资源，运行业务代码；另一个是数据库，负责存储业务数据。</p>

<p>业务层输出的内容分为两部分：动态+静态。对于动态居多的电商金融业务，以静态内容为主的CDN加速没有特别效果，而应该对数据接口进行接口加速（ADN，API Delivery Network）。接口加速需要注意的是，不能因给接口加Cache而影响业务本身。我们建议对所有读类型数据接口加Cache，并将Cache时间设定为毫秒级，针对不同接口指定不同Cache策略，有效提高Cache命中率。</p>

<p>根据实测，通过加ADN Cache，可提高60%访问速度，同时降低2-3倍后端实际负载。</p>

<h3>4  异步化-队列</h3>

<p>异步化-队列是通过队列将请求/事务放入后台运行，从同步阻塞模式变为异步非阻塞模式。例如，抢购发生时，用户同时调用支付接口，同步阻塞模式下，用户数量即支付接口的并发度，用户过多时，支付数据库压力过大，严重时可能会导致数据库服务宕机。采用异步模式后，抢购时，用户请求进入队列处理，队列并发度与数据库并发能力相匹配，用户请求按序进行，可有效保护数据后端。</p>

<p>队列不只可以保护后端数据库。在秒杀场景，很多用户抢购一个商品，可以先将抢购请求放入队列，再进入后台筛选处理（比如排重、按优先级排序等），最后调用实际下单接口。队列可以根据产品需求选用两种不同模式：一种是全异步模式，即进入队列后立即返回成功，通过回调通知调用者结果；另一种是半异步，即进入队列后，调用者挂起，实际执行结束后，再返回成功或者失败结果。</p>

<h3>5  总结</h3>

<p>应对“双十一”高并发，主要采用缓存+队列异步化，缓存的重点是每个环节，尤其是对于传统易忽略的数据接口，都要进行合理的Cache。</p>

<p>对于高并发请求，要进行异步化非阻塞处理，防止“洪水”现象，保证业务稳定有序进行。</p>

                </div>
            </div>
            <div class="col-sm-4">
    <div class="news-correlation">
        <h5>相关阅读 <span><a href="/zh/2017/01/20/news/">进入新闻首页</a></span></h5>
        <ul>
            <li><a href="/zh/2017/01/20/news-30/">白山：首创“乐高式松耦合”架构</a></li>
            <li><a href="/zh/2017/01/20/news-02/">Embrace delivery, storage and
                linkage for a 'post-cloud era'</a></li>
            <li><a href="/zh/2017/01/20/news-03/">从互联网+到“AI+”：中国互联网经济新动能</a></li>
            <li><a href="/zh/2017/01/20/news-04/">管理技术人，更要学会沟通</a></li>
            <li><a href="/zh/2017/01/20/news-05/">重构数据价值 云链网络共同体</a></li>
        </ul>
    </div>
</div>

            <div class="clean"></div>
        </div>
    </div>

    <div class="bottom-nav-cn hidden-xs">
    <h4>白山服务热线: <em>400-081-3388</em></h4>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="sidebar-nav-item"
       href="/zh/2016/07/01/Careers/">白山招聘</a>
    
    
    
    
    
    
    
    
    <a class="sidebar-nav-item"
       href="/zh/2016/04/01/Customers/">白山客户</a>
    
    
    <p class="copyright"><a class="sidebar-nav-item" style="border:none" href="http://www.miitbeian.gov.cn">京ICP备16037635号－3</a></p>
    <p class="copyright policeIcon">京公网安备 11010502032269号</p>
</div>


</div>

<script src="/zh/public/js/jquery-2.2.4.js"></script>
<script src="/zh/public/js/main.js"></script>
<script src="/zh/public/js/bootstrap.min.js"></script>
<script src="/zh/public/js/lightbox-plus-jquery.min.js"></script>
<script src="/zh/public/js/blocksit.min.js"></script>
<script src="/zh/public/js/slider.js"></script>
</body>
</html>
